# MATH-500 양자화 모델 성능 분석 리포트

**모델**: DeepSeek-R1-Distill-Qwen-1.5B
**데이터셋**: MATH-500
**비교 대상**: Baseline (FP16) vs AWQ 4-bit vs AWQ 3-bit
**분석 날짜**: 2026-01-05

---

## Executive Summary

| Model | Accuracy | Δ from Baseline |
|-------|----------|-----------------|
| **Baseline (FP16)** | 85.0% (425/500) | - |
| **AWQ 4-bit (w4g128)** | 83.4% (417/500) | **-1.6%p** |
| **AWQ 3-bit (w3g128)** | 52.6% (263/500) | **-32.4%p** |

**핵심 발견**: AWQ 3-bit 양자화에서 **Repetition Degeneration (반복 생성 붕괴)** 현상이 주요 실패 원인으로 확인됨.

---

## 1. 전체 성능 비교

### 1.1 정확도 분포

```
Baseline:  ████████████████████████████████████████████ 85.0%
AWQ 4-bit: ██████████████████████████████████████████   83.4%
AWQ 3-bit: ██████████████████████████                   52.6%
```

### 1.2 교차 정확도 분석

| 카테고리 | 개수 | 비율 | 의미 |
|---------|------|------|------|
| 3개 모델 모두 정답 | 247 | 49.4% | 안정적인 문제 |
| Baseline + AWQ4 정답, AWQ3 오답 | 147 | 29.4% | **3-bit 양자화 손실** |
| Baseline만 정답 | 24 | 4.8% | 양자화 민감 문제 |
| AWQ4만 정답 | 17 | 3.4% | AWQ4가 도움 |
| AWQ4 + AWQ3 정답, Baseline 오답 | 6 | 1.2% | 양자화가 오히려 도움 |
| 3개 모델 모두 오답 | 49 | 9.8% | 본질적으로 어려운 문제 |

---

## 2. AWQ 3-bit 실패 원인 심층 분석

### 2.1 실패 케이스 통계 (237개)

- **Baseline이 정답이었던 케이스**: 171개 (72.2%) → 양자화로 인한 성능 저하
- **Baseline도 오답이었던 케이스**: 66개 (27.8%) → 원래 어려운 문제

### 2.2 응답 길이 분석

| 구분 | 평균 단어 수 | 중앙값 | 최대 |
|------|------------|--------|------|
| **AWQ 3-bit 정답** | 6,714 | 2,433 | 26,978 |
| **AWQ 3-bit 오답** | 16,446 | 17,140 | 30,021 |
| Baseline (전체) | 2,983 | - | 25,602 |
| AWQ 4-bit (전체) | 2,959 | - | 22,011 |

**결론**: 오답 응답이 정답 응답보다 **2.45배** 더 길다.

### 2.3 오답 응답 길이 분포

```
0-1,000 words:     █ (0.4%)
1,000-3,000:       █ (3.0%)
3,000-5,000:       █ (1.3%)
5,000-10,000:      ████ (7.2%)
10,000-15,000:     ██████████ (19.0%)
15,000-20,000:     ███████████████████████ (45.6%)  ← 가장 많음
20,000-30,001:     ████████████ (23.2%)
```

### 2.4 반복 마커 분석

| 마커 | AWQ 3-bit 정답 (평균) | AWQ 3-bit 오답 (평균) | 배율 |
|------|---------------------|---------------------|------|
| `Wait,` | 415.0 | 906.5 | 2.18x |
| `Hmm` | 2.3 | 9.0 | 3.84x |
| `So,` | 72.3 | 257.6 | 3.56x |

### 2.5 최종 답변 생성 실패

- **정답 응답 중 `\boxed{}` 포함**: 70.0%
- **오답 응답 중 `\boxed{}` 포함**: **9.3%** ← 88.6%가 답을 생성하지 못함

---

## 3. Repetition Degeneration 현상 상세 분석

### 3.1 반복 강도별 분류

| 분류 | `Wait,` 횟수 | 개수 | 비율 |
|------|-------------|------|------|
| 반복 없음 | 0-50 | 12 | 5.1% |
| 경미한 반복 | 50-200 | 36 | 15.2% |
| 중간 반복 | 200-500 | 61 | 25.7% |
| 심각한 반복 | 500-1,000 | 55 | 23.2% |
| **극심한 반복** | 1,000-6,167 | 70 | **29.5%** |

### 3.2 반복 패턴 유형

#### Type A: Wait Loop
```
Wait, wait, wait, perhaps I can think of tan tan tan tan tan.
Wait, wait, wait, perhaps I can think of tan tan tan tan tan.
Wait, wait, wait, perhaps I can think of tan tan tan tan tan.
```
- 출현 빈도: 40개 (16.9%)
- 최대 반복: 6,167회 (Problem 211)

#### Type B: Number Loop
```
0.  0.  0.  0.  0.  0,0.  0.  0.  0.  0.  0.  0.  0.  0,0.
```
- 출현 빈도: 7개 (3.0%)

#### Type C: Gibberish Token
```
Vis, no.  Vis, no.  Vis, no.  Vis, no.  Vis, no.  vis, no.
```
- 출현 빈도: 7개 (3.0%)
- "Vis", "Vi"는 실제 영어 단어가 아닌 양자화로 인한 토큰 손상

#### Type D: Single Character
```
V.  V.  V.  V.  V.  V.  V.  V.  V.  V.  V.  V.  V.  V.  V.
```
- 출현 빈도: 7개 (3.0%)

#### Type E: 숫자 고착
```
444444444444444444444444444444444444444444444444444444
```

### 3.3 반복 발생 시점

```
응답 진행률 (%)   발생 빈도
 0-10%:           █ (1)
10-20%:           ████ (8)
20-30%:           ███ (6)
30-40%:           ████ (9)
40-50%:           █████ (11)      ← 대부분 전반부-중반부에서 시작
50-60%:           █ (2)
60-70%:           █ (2)
70-80%:           █ (1)
80-90%:           █ (1)
90-100%:          █████████████████████████████ (59)  ← 끝까지 정상인 척
```

**평균 반복 시작 지점**: 응답의 약 **25.8%** 지점에서 시작 (초반-중반)

### 3.4 응답 품질 저하 패턴

| Problem | 총 단어수 | 처음 1000 단어 Wait, | 마지막 1000 단어 Wait, | 악화 배율 |
|---------|----------|---------------------|----------------------|---------|
| 0 | 21,287 | 16 | 135 | **8.4x** |
| 38 | 22,212 | 25 | 192 | **7.7x** |
| 211 | 12,981 | 23 | 537 | **23.3x** |
| 387 | 15,516 | 9 | 501 | **55.7x** |

---

## 4. 문제 유형별 성능 분석

### 4.1 유형별 정확도

| 문제 유형 | 개수 | Baseline | AWQ 4-bit | AWQ 3-bit | 3-bit 하락 |
|---------|------|----------|-----------|-----------|-----------|
| Functions | 23 | 100.0% | 95.7% | 56.5% | **-43.5%p** |
| Geometry | 77 | 75.3% | 66.2% | 36.4% | **-39.0%p** |
| Combinatorics | 31 | 87.1% | 77.4% | 48.4% | **-38.7%p** |
| Probability | 16 | 68.8% | 87.5% | 31.2% | **-37.5%p** |
| Sequences | 14 | 78.6% | 92.9% | 42.9% | **-35.7%p** |
| Number Theory | 103 | 87.4% | 84.5% | 54.4% | **-33.0%p** |
| Word Problems | 29 | 86.2% | 82.8% | 58.6% | **-27.6%p** |
| Other/General | 152 | 90.1% | 88.8% | 63.8% | **-26.3%p** |
| Algebra | 44 | 77.3% | 84.1% | 54.5% | **-22.7%p** |
| **Trigonometry** | 11 | 81.8% | 90.9% | 18.2% | **-63.6%p** |

**가장 취약한 유형**: Trigonometry (삼각함수) - 63.6%p 하락!

### 4.2 평균 응답 길이 (AWQ 3-bit)

| 문제 유형 | 평균 단어수 |
|---------|-----------|
| Trigonometry | 15,092 |
| Geometry | 14,407 |
| Word Problems | 12,006 |
| Probability | 11,557 |

---

## 5. AWQ 4-bit 분석

### 5.1 실패 케이스 개요

- **총 오답**: 83개 (16.6%)
- Baseline도 오답: 52개 (62.7%)
- **Baseline 정답, AWQ4 오답**: 31개 (37.3%) → 순수 양자화 손실

### 5.2 AWQ 4-bit vs 3-bit 비교

| 지표 | AWQ 4-bit 오답 | AWQ 3-bit 오답 |
|------|---------------|----------------|
| 총 개수 | 83 | 237 |
| 평균 응답 길이 | 8,225 | 16,446 |
| 평균 `Wait,` | 174.7 | 906.5 |
| `\boxed{}` 없음 | 15.7% | **88.6%** |

### 5.3 AWQ 4-bit이 Baseline보다 나은 케이스 (23개)

흥미로운 발견: 일부 케이스에서 AWQ 4-bit이 Baseline보다 정답률이 높음.

**예시 - Problem 219 (Bake Sale 문제)**:
- Baseline: $78 계산 → 자기 의심 → $114로 잘못 수정 (오답)
- AWQ 4-bit: $78 계산 → 유지 (정답)

**원인 가설**: 양자화로 인한 약간의 정밀도 손실이 과도한 self-correction을 방지

---

## 6. 근본 원인 분석 (증거 기반)

### 6.1 가설 1: Attention 메커니즘 손상

Attention은 현재 토큰을 생성할 때 이전 토큰들과의 관계를 파악합니다. 3-bit 양자화로 인해 attention weight의 정밀도가 저하되면, 이전에 생성한 내용을 제대로 참조하지 못하게 됩니다.

#### 증거 1-1: 동일 문장 반복 (84% 발생률)

```
분석 결과: 50개 오답 샘플 중 42개(84%)에서 동일 문장이 5회 이상 반복됨

실제 사례:
• Problem 0: "Wait, perhaps I can think of tan 100°..." → 176회 반복!
• Problem 8: "Wait, that suggests that my conclusion is incorrect..." → 44회 반복
```

**해석**: Attention이 정상 작동하면 "이미 이 접근법을 시도했다"는 것을 인식해야 합니다. 하지만 같은 문장을 176회나 반복한다는 것은 이전 context를 전혀 참조하지 못한다는 증거입니다.

#### 증거 1-2: 자기 참조 빈도 52% 감소

```
측정 대상: "as I", "from above", "earlier", "we found", "we got" 등

자기 참조 빈도 (per 1000 words):
  • 정답 응답: 0.72
  • 오답 응답: 0.34  (52% 감소!)
```

**해석**: 정상적인 수학적 추론은 "앞서 계산한 것처럼...", "위에서 구한 값을 사용하면..."과 같이 이전 단계를 참조합니다. 오답 응답에서 이러한 참조가 절반으로 줄었다는 것은 **Attention이 이전 context를 제대로 활용하지 못한다**는 강력한 증거입니다.

#### 증거 1-3: Attention 손상 메커니즘 도식

```
┌─────────────────────────────────────────────────────────────────────────┐
│ 정상 Attention:                                                         │
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │ "I calculated sin(100°) = 0.985 earlier"                            │ │
│ │         ↓ Attention이 참조                                          │ │
│ │ "Using the value 0.985 from above..."                               │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│ 손상된 Attention (3-bit):                                               │
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │ "I calculated sin(100°) = 0.985 earlier"                            │ │
│ │         ✗ Attention이 참조 실패                                     │ │
│ │ "Let me calculate sin(100°)..." (처음부터 다시 시작)                 │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────┘
```

---

### 6.2 가설 2: Language Modeling Head 손상

LM Head는 hidden state를 vocabulary에 매핑하여 다음 토큰을 예측합니다. 3-bit 양자화로 LM Head가 손상되면 확률 분포가 왜곡되어 비정상적인 토큰이 선택됩니다.

#### 증거 2-1: Gibberish 토큰 출현 (1.85배 증가)

```
"Vi", "Vis" 등 의미 없는 토큰 출현 빈도:
  • 정답 응답: 평균 57.3회
  • 오답 응답: 평균 105.9회 (1.85배 증가)
  • 최대 사례: 4,312회 (응답 전체가 거의 gibberish)

실제 발생 맥락:
  "Vis,Vis,Vis,Vis,Vis,Vis,Vis,Vis,Vis,Vis,Vis,Vis,Vis,Vis,Vis..."
```

**해석**: "Vis"는 영어에서 거의 사용되지 않는 저빈도 토큰입니다. 정상적인 LM Head라면 이 토큰을 선택할 확률이 매우 낮습니다. 하지만 양자화로 인해 확률 분포가 왜곡되어 이러한 저빈도 토큰이 반복 선택됩니다.

#### 증거 2-2: 토큰 다양성 붕괴 (72-79% 감소)

```
토큰 다양성 = unique tokens / total tokens

전체 응답:
  • 정답 응답: 0.1751
  • 오답 응답: 0.0492  (72% 감소!)

마지막 2000 토큰만 분석:
  • 정답 응답: 0.1768
  • 오답 응답: 0.0377  (79% 감소!)
```

**해석**: 다양성 0.05는 **20개 토큰 중 1개만 고유**하다는 의미입니다. 즉, 거의 모든 토큰이 반복됩니다. 이는 LM Head가 소수의 토큰에만 높은 확률을 부여하는 **"mode collapse"** 현상입니다.

#### 증거 2-3: 시간에 따른 다양성 변화 (Problem 38)

```
응답 진행에 따른 토큰 다양성 추이:

Position   Diversity   시각화
────────   ─────────   ──────────────────────────────────
   1%       0.31       ████████████████████████████████
   6%       0.23       ████████████████████████
  12%       0.17       █████████████████
  17%       0.14       ██████████████
  24%       0.07       ███████  ← 이 지점에서 붕괴!
  33%       0.07       ███████  (이후 회복되지 않음)
```

**해석**: 응답의 **24% 지점**에서 다양성이 급격히 떨어지고 회복되지 않습니다. 이는 특정 시점에서 LM Head의 확률 분포가 완전히 왜곡되어 극소수의 토큰만 선택되기 시작했음을 보여줍니다.

#### 증거 2-4: Baseline vs AWQ 3-bit 토큰 분포 비교 (Problem 38)

```
Baseline 상위 10 토큰:           AWQ 3-bit 상위 10 토큰:
──────────────────────          ──────────────────────────
\(: 55                          Wait,: 3,430  ← 비정상!
the: 48                         no.: 1,489
\): 37                          I: 1,110
a: 33                           is: 1,032
z: 30                           no,: 1,032
is: 29                          \(: 1,006
in: 22                          think: 754
=: 20                           a: 647
c: 19                           \): 575
cylindrical: 18                 z: 568
```

**해석**:
- Baseline: 수학 기호(`\(`, `\)`, `=`)와 문제 관련 단어(`cylindrical`, `z`)가 상위권
- AWQ 3-bit: `Wait,`가 **3,430회**로 압도적 1위, 수학적 추론 토큰이 밀림

---

### 6.3 두 메커니즘의 상호작용

두 가지 손상이 결합되어 **악순환 루프**를 형성합니다:

```
┌────────────────────────────────────────────────────────────────────────────┐
│                        AWQ 3-BIT 실패 메커니즘                              │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                            │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐                   │
│  │  3-bit      │ ──► │  Attention  │ ──► │ 이전 context│                   │
│  │  양자화     │     │  Weight 손상│     │ 참조 실패   │                   │
│  └─────────────┘     └─────────────┘     └──────┬──────┘                   │
│                                                  │                         │
│                                                  ▼                         │
│                              ┌─────────────────────────────────┐           │
│                              │    같은 reasoning 패턴 반복     │           │
│                              │    (평균 906회 "Wait," 반복)    │           │
│                              └────────────────┬────────────────┘           │
│                                               │                            │
│  ┌─────────────┐     ┌─────────────┐         │                            │
│  │  3-bit      │ ──► │  LM Head    │         │                            │
│  │  양자화     │     │  Weight 손상│         │                            │
│  └─────────────┘     └─────────────┘         │                            │
│                              │                │                            │
│                              ▼                │                            │
│                      ┌─────────────┐         │                            │
│                      │ 확률 분포   │         │                            │
│                      │ 왜곡        │         │                            │
│                      └──────┬──────┘         │                            │
│                              │                │                            │
│                              ▼                ▼                            │
│                      ┌─────────────────────────────────────┐               │
│                      │    토큰 다양성 붕괴 (0.17 → 0.04)   │               │
│                      │    Gibberish 토큰 생성 (Vi, Vis)   │               │
│                      └────────────────┬────────────────────┘               │
│                                       │                                    │
│                                       ▼                                    │
│                              ┌─────────────────┐                           │
│                              │  최종 답변 생성  │                           │
│                              │  실패 (88.6%)   │                           │
│                              └─────────────────┘                           │
│                                                                            │
└────────────────────────────────────────────────────────────────────────────┘
```

---

### 6.4 실제 사례 비교: Problem 0

같은 문제에서 Baseline과 AWQ 3-bit의 추론 과정을 비교합니다.

```
문제: Simplify tan 100° + 4 sin 100°
정답: -√3

┌─────────────────────────────────────────────────────────────────────────────┐
│ BASELINE (정답)                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ Position 2000: "\csc \theta \right ) = -\sqrt{3}"                          │
│ Position 3000: "satisfy the original equation, so maybe there's..."        │
│                                                                             │
│ 결론: "Therefore, I can conjecture that the exact value is \(-\sqrt{3}\)"  │
│ 단어 수: 3,813 | Wait, 횟수: 30                                             │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ AWQ 3-BIT (오답)                                                            │
├─────────────────────────────────────────────────────────────────────────────┤
│ Position 2000: "2(1 - cos 20°) = -cos 10° + 2 -"                           │
│ Position 3000: "-sin 80° + 2 sin 20° = -[sin 60° cos..."                   │
│                                                                             │
│ 결론: "Wait, wait, wait, perhaps I can think of tan tan tan tan tan."      │
│ 단어 수: 21,287 | Wait, 횟수: 3,285                                         │
└─────────────────────────────────────────────────────────────────────────────┘

→ 같은 시작점에서 출발했으나 AWQ 3-bit은 결론에 도달하지 못함
→ 약 3,000 단어 지점까지는 수학적 추론이 진행되다가 이후 반복 루프에 진입
```

---

### 6.5 AWQ 4-bit의 상대적 안정성

4-bit 양자화는 대부분의 weight 정보를 보존하여 위의 문제들이 발생하지 않습니다.

| 지표 | AWQ 4-bit | AWQ 3-bit | 차이 |
|------|-----------|-----------|------|
| 정확도 | 83.4% | 52.6% | **+30.8%p** |
| 평균 응답 길이 | 2,959 | 11,327 | **3.8x 짧음** |
| 평균 Wait, 횟수 | 42.6 | 648.0 | **15.2x 적음** |
| 답변 생성 성공률 | 84.3% | 11.4% | **7.4x 높음** |
| 토큰 다양성 | 정상 | 붕괴 | - |

---

## 7. 대표적 실패 사례

### Case Study 1: Problem 0 (Trigonometry)
**문제**: Simplify tan 100° + 4 sin 100°

| 모델 | 답변 | 단어수 | Wait, 횟수 |
|------|-----|-------|-----------|
| Baseline | -√3 ✓ | 3,813 | 30 |
| AWQ 4-bit | -√3 ✓ | 4,790 | 43 |
| AWQ 3-bit | ❌ | 21,287 | **3,285** |

**AWQ 3-bit 시작**:
> "Okay, so I need to simplify the expression tan 100° + 4 sin 100°..."

**AWQ 3-bit 끝**:
> "Wait, wait, wait, perhaps I can think of tan tan tan tan tan..."

### Case Study 2: Problem 211 (Word Problem)
**문제**: Kathy's currency exchange problem

| 모델 | 답변 | 단어수 | Wait, 횟수 |
|------|-----|-------|-----------|
| Baseline | 48 ✓ | - | - |
| AWQ 4-bit | 48 ✓ | - | - |
| AWQ 3-bit | ❌ | 12,981 | **6,167** |

**AWQ 3-bit 끝**:
> "Wait,23. Wait,23. Wait,23. Wait,26. Wait,23..."

---

## 8. 결론 및 권고사항

### 8.1 핵심 발견

1. **AWQ 4-bit은 Reasoning 모델에 적합**
   - 1.6%p 정확도 하락으로 대부분의 추론 능력 보존
   - 일부 케이스에서 오히려 성능 향상

2. **AWQ 3-bit은 Reasoning 모델에 부적합**
   - 32.4%p 정확도 하락
   - **Repetition Degeneration**이 주요 실패 모드
   - 88.6%의 실패가 최종 답변 생성 실패

3. **취약한 문제 유형**
   - Trigonometry, Functions, Geometry, Combinatorics
   - 복잡한 추론이 필요한 문제일수록 3-bit 성능 저하 심각

### 8.2 권고사항

| 사용 시나리오 | 권장 양자화 |
|-------------|-----------|
| 정확도 최우선 | Baseline (FP16) |
| 메모리 효율 + 정확도 균형 | **AWQ 4-bit** |
| 극단적 메모리 제약 | AWQ 3-bit (**비권장**) |

### 8.3 향후 연구 방향

1. 3-bit에서 반복 생성 방지 기법 연구
2. Reasoning 모델 특화 양자화 기법 개발
3. 문제 유형별 적응적 양자화 전략

---

## Appendix: 데이터 요약

```
전체 문제: 500개
분석된 응답: 1,500개 (3개 모델 × 500문제)

AWQ 3-bit 오답 응답:
- 총 단어 수: 3,897,773 words
- 총 'Wait,' 횟수: 214,835회
- 평균 응답당: 16,446 words, 906 Wait,

최다 반복 기록:
- Problem 211: Wait, 6,167회
- Problem 387: Wait, 5,860회
- Problem 197: Wait, 5,361회
```

---

*Report generated by comprehensive analysis of MATH-500 benchmark results*
