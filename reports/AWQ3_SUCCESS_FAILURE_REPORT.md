# AWQ 3-bit 양자화 모델의 성공/실패 결정 요인 분석

## Executive Summary

본 보고서는 DeepSeek-R1-Distill-Qwen-1.5B 모델의 AWQ 3-bit 양자화 버전이 MATH-500 벤치마크에서 일부 문제(263개, 52.6%)에서 정답을 맞추고 나머지(237개, 47.4%)에서 실패한 원인을 심층 분석합니다.

### 핵심 발견

| 지표 | 성공 케이스 | 실패 케이스 |
|------|------------|------------|
| 케이스 수 | 263개 (52.6%) | 237개 (47.4%) |
| `\boxed{정답}` 형식 존재 | 54.8% | 0.4% |
| 텍스트 내 정답 포함 | 86.3% | 47.7% |
| 반복 루프 전 정답 계산 | 78.0% | 31.6% |
| 평균 Baseline 응답 길이 | 1,647 단어 | 3,854 단어 |

---

## 1. 성공/실패의 근본 메커니즘

### 1.1 핵심 발견: "Race Condition"

AWQ 3-bit 모델의 성공/실패는 **"답 도출 vs 반복 루프 진입"의 경쟁** 결과입니다.

```
┌─────────────────────────────────────────────────────────────────┐
│                      성공 시나리오                               │
│  [문제 이해] → [추론 진행] → [정답 도출] → [반복 루프 진입]      │
│                              ↑                                   │
│                     Extractive Match 성공                        │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                      실패 시나리오                               │
│  [문제 이해] → [추론 진행] → [반복 루프 진입] → (영원히 루프)    │
│                              ↑                                   │
│                     정답 도출 기회 상실                          │
└─────────────────────────────────────────────────────────────────┘
```

### 1.2 Extractive Match 메트릭의 동작

분석 결과, `extractive_match` 메트릭은 다음 패턴을 인식합니다:

| 패턴 | 성공 케이스 비율 |
|------|------------------|
| `\boxed{정확한 정답}` | 52% |
| "answer is [정답]" / "answer = [정답]" | 14% |
| "= [정답]" (결론부) | 5% |
| 기타 결론 패턴 | 29% |

실패 케이스에서는:
- **57%**: 정답이 텍스트에 전혀 없음
- **15%**: 정답이 중간 계산에만 등장 (결론 없이 루프 진입)
- **11%**: "= [정답]" 후 바로 "Wait, let me check..." 패턴

---

## 2. 성공 결정 요인 상세 분석

### 2.1 문제 복잡도 (Baseline 응답 길이)

Baseline 모델의 응답 길이는 문제 복잡도의 proxy로 사용됩니다.

| Baseline 응답 길이 | 성공 수 | 실패 수 | **성공률** |
|-------------------|---------|---------|------------|
| < 500 단어 | 4 | 1 | **80.0%** |
| 500-1,000 단어 | 99 | 36 | **73.3%** |
| 1,000-1,500 단어 | 78 | 32 | **70.9%** |
| 1,500-2,000 단어 | 40 | 30 | **57.1%** |
| 2,000-3,000 단어 | 17 | 24 | **41.5%** |
| 3,000-5,000 단어 | 11 | 47 | **19.0%** |
| 5,000-10,000 단어 | 9 | 38 | **19.1%** |
| ≥ 10,000 단어 | 5 | 29 | **14.7%** |

**결론**: 간단한 문제(< 1,500 단어)에서는 ~70% 성공률, 복잡한 문제(> 3,000 단어)에서는 ~19% 성공률

### 2.2 Wait, 반복 패턴 분석

"Wait," 패턴의 밀도를 기준으로 분류:

| 패턴 유형 | 설명 | 성공 비율 | 실패 비율 |
|-----------|------|-----------|-----------|
| `no_repeat` | Wait, 없거나 1-2개 | 4.6% | 0.4% |
| `tight_loop` | 100자 미만 간격 반복 | 15.6% | **40.5%** |
| `medium_repeat` | 100-500자 간격 반복 | **57.4%** | 52.7% |
| `sparse_wait` | 500자 이상 간격 | 22.4% | 6.3% |

**핵심**: `tight_loop` 패턴(긴밀한 반복)은 실패 케이스에서 2.6배 더 빈번

### 2.3 반복 루프 시작 시점

| 지표 | 성공 케이스 | 실패 케이스 |
|------|------------|------------|
| 루프 시작 위치 (평균) | 4,235자 | 4,835자 |
| 루프 시작 위치 (중앙값) | 3,643자 | 3,457자 |
| 정답 위치 (평균) | 텍스트의 21.4% | 텍스트의 6.7% |

**해석**:
- 성공 케이스는 더 늦게 루프에 진입하면서도 정답을 이미 출력한 상태
- 실패 케이스는 더 빨리 루프에 진입하여 정답 도출 기회를 상실

---

## 3. 성공 케이스 유형 분류

### 3.1 Short & Clean (137개, 52.1%)

- **특징**: 평균 1,388 단어, 14회 Wait,
- **메커니즘**: 문제가 단순하여 반복 루프 진입 전 빠르게 정답 도출
- **예시**: 기본 산술, 단순 대수 문제

```
문제: 구의 부피와 표면적이 수치적으로 같을 때 반지름은?
응답: [정상 풀이 → r = 3 도출 → 잠시 Wait, → 정답 유지]
```

### 3.2 Medium Clean (38개, 14.4%)

- **특징**: 평균 3,390 단어, 81회 Wait,
- **메커니즘**: 중간 복잡도 문제, 여러 번 재검토하면서도 정답 유지
- **주목할 점**: Wait, 이 많지만 `\boxed{}` 형식으로 정답을 명확히 출력

### 3.3 Long but Survived (39개, 14.8%)

- **특징**: 평균 14,674 단어, 235회 Wait,
- **메커니즘**: 긴 응답이지만 정답이 텍스트 어딘가에 포함됨
- **성공 이유**: Extractive match가 정답을 찾아냄 (비록 `\boxed{}` 없이도)

### 3.4 High Wait, Survived (49개, 18.6%)

- **특징**: 평균 17,849 단어, 1,938회 Wait,
- **메커니즘**: 심각한 반복 루프 진입, 그러나 루프 이전에 정답 계산 완료
- **예시 분석**:

```
Problem 5 (정답: 3)
- Wait, 횟수: 1,699회
- 루프 시작: 텍스트의 0.4% 지점
- 성공 이유: "r = 3" 계산이 루프 진입 전에 완료됨
- 마지막 500자: "Wait, that is correct. Wait, perhaps I should think about..."
```

---

## 4. 실패 케이스 유형 분류

### 4.1 Early Loop Entry (124개, 52.3%)

- **특징**: 정답이 텍스트에 전혀 없음
- **메커니즘**: 문제 이해/초기 추론 단계에서 바로 반복 루프 진입
- **분석**: 복잡한 문제에서 attention 메커니즘 실패로 추론 경로 상실

### 4.2 Incomplete Calculation (75개, 31.6%)

- **특징**: 정답이 텍스트에 있지만 결론 미도달
- **하위 분류**:

| 유형 | 개수 | 설명 |
|------|------|------|
| 중간 계산에만 등장 | 15개 | "x = 45" 후 "Wait, is that right?" → 루프 |
| 우연히 등장 | 57개 | 정답이 문제문이나 다른 맥락에 등장 |
| boxed 유사 형식 | 5개 | `\boxed{}`는 있으나 다른 값 포함 |

### 4.3 정답 길이와 False Positive

짧은 정답(1-2자리 숫자)은 우연히 텍스트에 등장할 확률이 높습니다:

| 정답 길이 | 텍스트 포함 but 실패 |
|-----------|---------------------|
| 1-2자 (예: "3", "45") | 57개 |
| 3자 이상 | 18개 |

**시사점**: 짧은 정답은 "계산 결과로서의 등장"이 아닌 경우가 많음

---

## 5. 실패 예측 지표

### 5.1 강력한 예측 지표

| 지표 | 실패 확률 |
|------|-----------|
| Baseline 응답 > 3,000 단어 | **81%** |
| 첫 500자 내 반복 패턴 시작 | **76%** |
| `\boxed{}` 형식 부재 | **88.6%** |

### 5.2 실패 예측 흐름도

```
┌──────────────────────────────────────────────────────────────┐
│                    Baseline 응답 길이                         │
│                          │                                    │
│            ┌─────────────┼─────────────┐                      │
│            ▼             │             ▼                      │
│      < 1,500 단어        │      > 3,000 단어                  │
│     (성공률 70%)         │     (성공률 19%)                   │
│            │             │             │                      │
│            ▼             ▼             ▼                      │
│    ┌───────────────┐   ┌───────────────┐                      │
│    │ tight_loop?   │   │ 대부분 실패   │                      │
│    └───────┬───────┘   └───────────────┘                      │
│      No    │    Yes                                           │
│      │     │                                                  │
│      ▼     ▼                                                  │
│   성공가능  실패가능                                           │
└──────────────────────────────────────────────────────────────┘
```

---

## 6. 결론 및 시사점

### 6.1 AWQ 3-bit 성공의 조건

1. **단순한 문제**: Baseline 응답 1,500 단어 이하에서 70% 성공
2. **빠른 정답 도출**: 반복 루프 진입 전 정답 계산 완료
3. **명확한 결론**: `\boxed{}` 또는 "the answer is" 형식으로 정답 제시

### 6.2 AWQ 3-bit 실패의 원인

1. **복잡한 문제**: Baseline 응답 3,000 단어 초과 시 81% 실패
2. **조기 루프 진입**: 정답 계산 전 "Wait," 반복 시작
3. **결론 미도달**: 중간 계산에서 멈추고 영구 루프

### 6.3 양자화 임계점 존재

AWQ 3-bit는 4-bit(83.4%)와 3-bit(52.6%) 사이에서 급격한 성능 저하를 보입니다. 이는:

- **Attention 메커니즘**: 3-bit에서 장기 의존성 유지 실패
- **LM Head**: 확률 분포 왜곡으로 "Wait," 등 특정 토큰에 갇힘
- **복잡도 임계점**: 추론 단계가 많아질수록 오차 누적

### 6.4 실용적 권장사항

| 사용 시나리오 | AWQ 3-bit 적합성 |
|---------------|------------------|
| 단순 수학 (산술, 기본 대수) | ✅ 적합 (70% 성공) |
| 중간 복잡도 | ⚠️ 주의 (50% 성공) |
| 복잡한 다단계 추론 | ❌ 부적합 (19% 성공) |

---

## 부록: 분석 방법론

- **데이터**: MATH-500 벤치마크, 500개 문제
- **모델**: DeepSeek-R1-Distill-Qwen-1.5B (Baseline, AWQ-w4g128, AWQ-w3g128)
- **메트릭**: extractive_match (정답 추출 일치도)
- **분석 도구**: Python, regex 패턴 분석, 통계적 상관관계 분석
